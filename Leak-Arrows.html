<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black P-Trap Leak Detector</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
        }
        .canvas-wrapper {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: 2px solid #444;
            border-radius: 4px;
            overflow: hidden;
            background-color: #000;
        }
        canvas {
            display: block;
            max-width: 100%; /* Responsive scaling */
            height: auto;
        }
        .legend {
            margin-top: 15px;
            text-align: center;
            background: #333;
            padding: 10px 20px;
            border-radius: 8px;
        }
        .legend span {
            color: #ff3333;
            font-weight: bold;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <div class="canvas-wrapper">
        <canvas id="plumbingCanvas"></canvas>
    </div>

    <div class="legend">
        <span>&#10140;</span> Indicates high-risk leak points (Loose nuts or bad washers)
    </div>

<script>
    const canvas = document.getElementById('plumbingCanvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

    // --------------------------------------------------------
    // TODO: Ensure your image file is named 'black-trap.jpg'
    // --------------------------------------------------------
    img.src = 'black-trap.jpg'; 

    // Coordinates estimated based on the visual layout of your specific image
    // (Assuming a roughly 400-500px wide image scale for relative mapping)
    const leakPoints = [
        {
            name: "Strainer Locknut",
            x: 175, y: 70,  // The brass nut at the very top
            direction: "left"
        },
        {
            name: "Tailpiece Slip Nut",
            x: 175, y: 235, // The top black nut connecting chrome to plastic
            direction: "left"
        },
        {
            name: "Union Nut",
            x: 275, y: 330, // The middle black nut connecting the two curves
            direction: "bottom-right"
        },
        {
            name: "Wall Adapter Nut",
            x: 350, y: 240, // The white nut on the far right
            direction: "top-right"
        }
    ];

    img.onload = function() {
        // Set canvas to match the natural resolution of the image
        canvas.width = img.width;
        canvas.height = img.height;

        // Draw the image
        ctx.drawImage(img, 0, 0);

        // We need to scale our coordinate mapping if the loaded image 
        // is different than the resolution I estimated (approx 380x380).
        // This calculates a scaling factor.
        const scaleX = canvas.width / 380; 
        const scaleY = canvas.height / 380;

        leakPoints.forEach(point => {
            drawArrow(
                point.x * scaleX, 
                point.y * scaleY, 
                point.direction
            );
        });
    };

    function drawArrow(targetX, targetY, direction) {
        const arrowLength = 60;
        const headSize = 15;
        let startX, startY;

        // Determine start position based on direction to avoid covering the pipe
        if (direction === "left") {
            startX = targetX - arrowLength;
            startY = targetY;
        } else if (direction === "right") {
            startX = targetX + arrowLength;
            startY = targetY;
        } else if (direction === "bottom-right") {
            startX = targetX + (arrowLength * 0.7);
            startY = targetY + (arrowLength * 0.7);
        } else if (direction === "top-right") {
            startX = targetX + (arrowLength * 0.7);
            startY = targetY - (arrowLength * 0.7);
        } else {
            // default from left
            startX = targetX - arrowLength;
            startY = targetY;
        }

        ctx.beginPath();
        
        // Styling specifically for visibility on BLACK plastic
        ctx.strokeStyle = "#ff3333"; // Neon Red
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";

        // Add a white glow/shadow so the red arrow pops against the black pipe
        ctx.shadowColor = "rgba(255, 255, 255, 0.8)";
        ctx.shadowBlur = 8;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;

        // Draw Shaft
        ctx.moveTo(startX, startY);
        ctx.lineTo(targetX, targetY);

        // Calculate Arrowhead angle
        const angle = Math.atan2(targetY - startY, targetX - startX);

        // Draw Arrowhead
        ctx.lineTo(targetX - headSize * Math.cos(angle - Math.PI / 6), targetY - headSize * Math.sin(angle - Math.PI / 6));
        ctx.moveTo(targetX, targetY);
        ctx.lineTo(targetX - headSize * Math.cos(angle + Math.PI / 6), targetY - headSize * Math.sin(angle + Math.PI / 6));

        ctx.stroke();
        
        // Reset shadow for next element
        ctx.shadowColor = "transparent";
        ctx.shadowBlur = 0;
        
        // Optional: Draw a "Bullseye" dot at the tip
        ctx.beginPath();
        ctx.arc(targetX, targetY, 4, 0, 2 * Math.PI);
        ctx.fillStyle = "#ff3333";
        ctx.fill();
    }

    img.onerror = function() {
        ctx.fillStyle = "#333";
        ctx.fillRect(0,0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.font = "16px sans-serif";
        ctx.fillText("Error: 'black-trap.jpg' not found.", 20, 50);
    }
</script>

</body>
</html>